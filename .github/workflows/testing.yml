name: Tests

on: push

env: 
  SERVER_HOST: 209.38.96.160
  
jobs: 
  test:
    runs-on: ubuntu-latest 
    steps:
      - name: Get backend repository code
        uses: actions/checkout@v4
        with: 
          repository: 'MrDenis2024/wingsfit-backend'
          path: 'wingsfit-backend'
      - name: Repo
        run: pwd;ls;ls wingsfit-backend 
      - name: Install dependecies backend
        run: cd wingsfit-backend && npm ci
      - name: Start MongoDB
        uses: supercharge/mongodb-github-action@1.11.0
        with:
          mongodb-version: 8.0
          mongodb-db: wingsfit
      - name: Start backend
        run: npm run dev
      - name: Get frontend repository code
        uses: actions/checkout@v4
      - name: Install dependecies frontend
        run: npm ci && npm run dev 
      - name: Test install dependecies
        run: cd tests/ && npm ci
      - name: Test run
        run: | 
          cd tests/ && npx codeceptjs run --verbose --override '{"helpers": {"Puppeteer": {"show": false}}}' --steps ; ls -lah output
      - uses: actions/upload-artifact@v4
        if: ${{always()}}
        with:
          name: my-artifact
          path: /home/runner/work/wingsfit-frontend/wingsfit-frontend/tests/output

      
